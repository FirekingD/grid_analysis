library(dplyr)
library(ggplot2)
library(ade4)
library(factoextra)
#install.packages("lattice")
#install.packages("geojsonsf")
#install.packages("sf")
#install.packages("readxl")
#install.packages("xlsx")
install.packages("mapview")
library(mapview)
library(xlsx)

library(geojsonsf)
library(sf)
library(lattice)
library(GGally)
library(readxl)
setwd("D:/dem/grid_analysis")
conso_elec<- read.csv("./data/consommation_annuelle_residentielle_adresse_paris.csv",sep=";")
prod_elec<- read.csv("./data/production-electrique-par-filiere-a-la-maille-region.csv", sep=";")
iris_paris<-st_read(dsn="data",layer="iris_paris")
#plot(iris_paris)
iris_paris_joined_conso<-merge(iris_paris,conso_elec,by.x="CODE_IRIS",by.y="Code.IRIS",type="full")
#plot(iris_paris_joined_conso$geometry)
iris_paris_joined_conso2018<-filter(iris_paris_joined_conso,Année=="2018")
iris_paris_joined_conso2019<-filter(iris_paris_joined_conso,Année=="2019")
iris_paris_joined_conso2020<-filter(iris_paris_joined_conso,Année=="2020")
ggplot(iris_paris_joined_conso2018,aes(x = geometry,y=Consommation.annuelle.moyenne.par.logement.de.l.adresse..MWh.))+geom_tile()
mapview(iris_paris_joined_conso2018) + mapview(iris_paris_joined_conso2018$Consommation.annuelle.moyenne.de.la.commune..MWh.)
gradient_color <- colorRampPalette(c("blue", "red"))
plot(iris_paris_joined_conso2018["Consommation.annuelle.moyenne.par.logement.de.l.adresse..MWh."],
     main="Consommation.annuelle.moyenne.",
     key.pos=4, col=gradient_color(20), legend=TRUE)

ggplot(head(iris_paris_joined_conso2018,100)) +
  geom_sf(aes(fill = Consommation.annuelle.moyenne.par.logement.de.l.adresse..MWh.))
